{"ast":null,"code":"import _objectSpread from\"/Users/muhammadrenauldi/Development/fa/frontend/memberpage/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{toast}from'react-toastify';import users from'constants/api/users';import axios,{setAuthorizationHeader}from'./index';export default function errorHandler(error){if(error){var message;if(error.response){var originalRequest=error.config;if(error.response.status===500){message='Something went terribly wrong';}else if(error.response.status===403&&!originalRequest._retry){if(error.response.data.message==='jwt expired'){window.location.href='/login';localStorage.removeItem('FA:token');}console.log(error.response.data.message);originalRequest._retry=true;var session=localStorage['FA:token']?JSON.parse(localStorage['FA:token']):null;return users.refresh({refresh_token:session.refresh_token,npm:session.u}).then(function(res){if(res.data){setAuthorizationHeader(res.data.token);localStorage.setItem('FA:token',JSON.stringify(_objectSpread(_objectSpread({},session),{},{token:res.data.token})));originalRequest.headers.authorization=res.data.token;return axios(originalRequest);}else{window.location.href='/login';localStorage.removeItem('FA:token');}});}else{message=error.response.data.message;}if(typeof message==='string')toast.error(message);return Promise.reject(error);}}}","map":{"version":3,"sources":["/Users/muhammadrenauldi/Development/fa/frontend/memberpage/src/configs/axios/errorHandler.js"],"names":["toast","users","axios","setAuthorizationHeader","errorHandler","error","message","response","originalRequest","config","status","_retry","data","window","location","href","localStorage","removeItem","console","log","session","JSON","parse","refresh","refresh_token","npm","u","then","res","token","setItem","stringify","headers","authorization","Promise","reject"],"mappings":"gLAAA,OAASA,KAAT,KAAsB,gBAAtB,CACA,MAAOC,CAAAA,KAAP,KAAkB,qBAAlB,CAEA,MAAOC,CAAAA,KAAP,EAAgBC,sBAAhB,KAA8C,SAA9C,CAEA,cAAe,SAASC,CAAAA,YAAT,CAAsBC,KAAtB,CAA6B,CAC3C,GAAIA,KAAJ,CAAW,CACV,GAAIC,CAAAA,OAAJ,CACA,GAAID,KAAK,CAACE,QAAV,CAAoB,CACnB,GAAMC,CAAAA,eAAe,CAAGH,KAAK,CAACI,MAA9B,CACA,GAAIJ,KAAK,CAACE,QAAN,CAAeG,MAAf,GAA0B,GAA9B,CAAmC,CAClCJ,OAAO,CAAG,+BAAV,CACA,CAFD,IAEO,IAAID,KAAK,CAACE,QAAN,CAAeG,MAAf,GAA0B,GAA1B,EAAiC,CAACF,eAAe,CAACG,MAAtD,CAA8D,CACpE,GAAIN,KAAK,CAACE,QAAN,CAAeK,IAAf,CAAoBN,OAApB,GAAgC,aAApC,CAAmD,CAClDO,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,QAAvB,CACAC,YAAY,CAACC,UAAb,CAAwB,UAAxB,EACA,CACDC,OAAO,CAACC,GAAR,CAAYd,KAAK,CAACE,QAAN,CAAeK,IAAf,CAAoBN,OAAhC,EACAE,eAAe,CAACG,MAAhB,CAAyB,IAAzB,CACA,GAAMS,CAAAA,OAAO,CAAGJ,YAAY,CAAC,UAAD,CAAZ,CACbK,IAAI,CAACC,KAAL,CAAWN,YAAY,CAAC,UAAD,CAAvB,CADa,CAEb,IAFH,CAGA,MAAOf,CAAAA,KAAK,CACVsB,OADK,CACG,CACRC,aAAa,CAAEJ,OAAO,CAACI,aADf,CAERC,GAAG,CAAEL,OAAO,CAACM,CAFL,CADH,EAKLC,IALK,CAKA,SAACC,GAAD,CAAS,CACd,GAAIA,GAAG,CAAChB,IAAR,CAAc,CACbT,sBAAsB,CAACyB,GAAG,CAAChB,IAAJ,CAASiB,KAAV,CAAtB,CACAb,YAAY,CAACc,OAAb,CACC,UADD,CAECT,IAAI,CAACU,SAAL,gCACIX,OADJ,MAECS,KAAK,CAAED,GAAG,CAAChB,IAAJ,CAASiB,KAFjB,GAFD,EAQArB,eAAe,CAACwB,OAAhB,CAAwBC,aAAxB,CAAwCL,GAAG,CAAChB,IAAJ,CAASiB,KAAjD,CAEA,MAAO3B,CAAAA,KAAK,CAACM,eAAD,CAAZ,CACA,CAbD,IAaO,CACNK,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,QAAvB,CACAC,YAAY,CAACC,UAAb,CAAwB,UAAxB,EACA,CACD,CAvBK,CAAP,CAwBA,CAlCM,IAkCA,CACNX,OAAO,CAAGD,KAAK,CAACE,QAAN,CAAeK,IAAf,CAAoBN,OAA9B,CACA,CAED,GAAI,MAAOA,CAAAA,OAAP,GAAmB,QAAvB,CAAiCN,KAAK,CAACK,KAAN,CAAYC,OAAZ,EAEjC,MAAO4B,CAAAA,OAAO,CAACC,MAAR,CAAe9B,KAAf,CAAP,CACA,CACD,CACD","sourcesContent":["import { toast } from 'react-toastify';\nimport users from 'constants/api/users';\n\nimport axios, { setAuthorizationHeader } from './index';\n\nexport default function errorHandler(error) {\n\tif (error) {\n\t\tlet message;\n\t\tif (error.response) {\n\t\t\tconst originalRequest = error.config;\n\t\t\tif (error.response.status === 500) {\n\t\t\t\tmessage = 'Something went terribly wrong';\n\t\t\t} else if (error.response.status === 403 && !originalRequest._retry) {\n\t\t\t\tif (error.response.data.message === 'jwt expired') {\n\t\t\t\t\twindow.location.href = '/login';\n\t\t\t\t\tlocalStorage.removeItem('FA:token');\n\t\t\t\t}\n\t\t\t\tconsole.log(error.response.data.message);\n\t\t\t\toriginalRequest._retry = true;\n\t\t\t\tconst session = localStorage['FA:token']\n\t\t\t\t\t? JSON.parse(localStorage['FA:token'])\n\t\t\t\t\t: null;\n\t\t\t\treturn users\n\t\t\t\t\t.refresh({\n\t\t\t\t\t\trefresh_token: session.refresh_token,\n\t\t\t\t\t\tnpm: session.u,\n\t\t\t\t\t})\n\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\tif (res.data) {\n\t\t\t\t\t\t\tsetAuthorizationHeader(res.data.token);\n\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t'FA:token',\n\t\t\t\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\t\t\t\t...session,\n\t\t\t\t\t\t\t\t\ttoken: res.data.token,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\toriginalRequest.headers.authorization = res.data.token;\n\n\t\t\t\t\t\t\treturn axios(originalRequest);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location.href = '/login';\n\t\t\t\t\t\t\tlocalStorage.removeItem('FA:token');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmessage = error.response.data.message;\n\t\t\t}\n\n\t\t\tif (typeof message === 'string') toast.error(message);\n\n\t\t\treturn Promise.reject(error);\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}